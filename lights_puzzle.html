<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>도서를 훔친 범인을 찾아라 - 전등 퍼즐</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Inter 폰트 적용 */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            display: flex;
            flex-direction: column; /* 세로 정렬 */
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            background-image: linear-gradient(to bottom right, #2d3748, #1a202c);
            color: #e2e8f0;
        }
        .container {
            background-color: #2d3748;
            padding: 3rem;
            border-radius: 1.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 800px; /* Adjust max-width for overall content */
            width: 100%;
            text-align: center;
            border: 2px solid #4a5568;
        }
        .story-text {
            font-size: 1.125rem; /* Text-lg */
            line-height: 1.75;
            color: #cbd5e1;
            margin-top: 1.5rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        /* 대사 스타일 */
        .dialogue-box {
            background-color: #3a475a; /* Slightly lighter dark background for dialogue */
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-top: 1rem; /* 대사 박스 간 간격 조정 */
            margin-bottom: 1rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: left;
            width: 90%;
            max-width: 600px;
        }
        .dialogue-speaker {
            font-size: 1.1rem;
            font-weight: 700;
            color: #fbd38d; /* Light orange for speaker name */
            margin-bottom: 0.5rem;
        }
        .dialogue-text {
            font-size: 1.25rem; /* Text-xl */
            line-height: 1.6;
            color: #e2e8f0;
        }
        /* 새로운 이미지 스타일 */
        .scene-image {
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem; /* 이미지 아래 대사와의 간격 */
            border: 3px solid #6366f1; /* Indigo border for emphasis */
            width: 100%;
            max-width: 600px; /* Adjust max-width for the image */
            height: auto;
            object-fit: cover;
        }

        /* 전구의 그림자 효과를 위한 사용자 정의 CSS */
        .light {
            background-color: #4a5568; /* Off state color */
            transition: all 0.3s ease-in-out;
        }
        .light.on {
            background-color: #facc15; /* Yellow-400 for on state */
            box-shadow: 0 0 20px #facc15, 0 0 40px #facc15, 0 0 60px #facc15;
            border-color: #fcd34d; /* Yellow-500 border */
        }
        .light span {
            color: #a0aec0; /* Gray-400 for number when off */
            transition: color 0.3s ease-in-out;
        }
        .light.on span {
            color: #374151; /* Gray-800 for number when on */
        }
        .control-button {
            background-color: #6366f1; /* Indigo-600 */
            transition: all 0.2s ease-in-out;
        }
        .control-button:hover {
            background-color: #4f46e5; /* Indigo-700 */
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(99, 102, 241, 0.4);
        }
        .control-button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5);
        }
        #reset-button {
            background-color: #6b7280; /* Gray-500 */
        }
        #reset-button:hover {
            background-color: #4b5563; /* Gray-600 */
        }
        #puzzle-message {
            color: #34d399; /* Green-400 */
        }

        /* Responsive adjustments */
        @media (max-width: 640px) {
            .light {
                width: 20vw; /* Smaller on small screens */
                height: 20vw;
                max-width: 80px;
                max-height: 80px;
            }
            .light span {
                font-size: 1.25rem;
            }
            .control-button {
                padding: 0.75rem 1.25rem;
                font-size: 0.875rem;
            }
            .container {
                padding: 2rem;
            }
            .dialogue-box {
                padding: 1rem;
                margin-top: 1rem;
                margin-bottom: 1rem;
            }
            .dialogue-text {
                font-size: 1.1rem;
            }
            .scene-image {
                margin-bottom: 1.5rem;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 flex flex-col items-center justify-center min-h-screen p-4">
    <div class="container">
        <h1 class="text-3xl md:text-4xl font-bold text-yellow-400 mb-6">잃어버린 책을 찾아서..</h1>

        <img src="running.png" alt="running"
             class="scene-image">

        <!-- 대사 추가 -->
        <div class="dialogue-box">
            <p class="dialogue-speaker">주인공:</p>
            <p class="dialogue-text">"처음으로 들어온 최 학생! 너가 범인이구나! 책은 어딨어!"</p>
        </div>
        <div class="dialogue-box">
            <p class="dialogue-speaker">최 학생:</p>
            <p class="dialogue-text">"안돼 걸려버렸어 어떡해! 으앙!"</p>
        </div>

        <p class="story-text mb-4 text-center">
            최 학생은 울면서 도망치더니, 도서관 전체의 전원을 내려버렸습니다.
            혼란스러운 도서관은 암흑에 잠겼고, 배선이 꼬인 탓인지 전등들이 이상하게 켜지고 있습니다.
            모든 전등을 켜서 도서관을 밝히고 다음 단서를 찾아야 합니다.
        </p>

        <!-- 전구 패널 -->
        <div id="lights-panel" class="flex flex-wrap justify-center gap-6 mb-8">
            <!-- 각 전구는 'light' 클래스와 고유 ID를 가집니다. 초기에는 'off' 상태입니다. -->
            <div id="light-0" class="light w-24 h-24 rounded-full border-4 border-gray-700 flex items-center justify-center">
                <span class="text-xl font-semibold">1</span>
            </div>
            <div id="light-1" class="light w-24 h-24 rounded-full border-4 border-gray-700 flex items-center justify-center">
                <span class="text-xl font-semibold">2</span>
            </div>
            <div id="light-2" class="light w-24 h-24 rounded-full border-4 border-gray-700 flex items-center justify-center">
                <span class="text-xl font-semibold">3</span>
            </div>
            <div id="light-3" class="light w-24 h-24 rounded-full border-4 border-gray-700 flex items-center justify-center">
                <span class="text-xl font-semibold">4</span>
            </div>
            <div id="light-4" class="light w-24 h-24 rounded-full border-4 border-gray-700 flex items-center justify-center">
                <span class="text-xl font-semibold">5</span>
            </div>
        </div>

        <!-- 버튼 패널 -->
        <div id="buttons-panel" class="flex flex-wrap justify-center gap-4">
            <!-- 각 버튼은 'control-button' 클래스와 고유 ID를 가집니다. -->
            <button id="button-0" class="control-button py-3 px-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-opacity-75">
                스위치 A
            </button>
            <button id="button-1" class="control-button py-3 px-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-opacity-75">
                스위치 B
            </button>
            <button id="button-2" class="control-button py-3 px-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-opacity-75">
                스위치 C
            </button>
            <button id="button-3" class="control-button py-3 px-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-opacity-75">
                스위치 D
            </button>
            <button id="button-4" class="control-button py-3 px-6 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-opacity-75">
                스위치 E
            </button>
        </div>

        <!-- 퍼즐 완료 메시지 -->
        <p id="puzzle-message" class="text-2xl font-semibold mt-8 hidden">
            축하합니다! 전구 퍼즐을 해결했습니다!
        </p>

        <!-- 리셋 버튼 -->
        <button id="reset-button" class="py-2 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-opacity-75 mt-6">
            초기화
        </button>
    </div>

    <script>
        // 모든 전구 요소를 가져옵니다.
        const lights = Array.from({ length: 5 }, (_, i) => document.getElementById(`light-${i}`));
        // 모든 버튼 요소를 가져옵니다.
        const buttons = Array.from({ length: 5 }, (_, i) => document.getElementById(`button-${i}`));
        // 퍼즐 완료 메시지 요소를 가져옵니다.
        const puzzleMessage = document.getElementById('puzzle-message');
        // 리셋 버튼 요소를 가져옵니다.
        const resetButton = document.getElementById('reset-button');

        // --- 퍼즐 로직 변수 ---
        // 각 전구의 현재 상태를 저장하는 배열 (true: 켜짐, false: 꺼짐)
        let lightStates = [false, false, false, false, false];

        // 각 버튼이 어떤 전구에 영향을 미치는지 정의합니다. (PSAT 스타일로 복잡하게)
        // 이 배열을 통해 퍼즐의 난이도를 조절할 수 있습니다.
        // 예시:
        // 스위치 A (0): 전구 1, 2, 3 토글
        // 스위치 B (1): 전구 2, 4 토글
        // 스위치 C (2): 전구 1, 3, 5 토글
        // 스위치 D (3): 전구 3, 4 토글
        // 스위치 E (4): 전구 2, 5 토글
        const buttonEffects = [
            [0, 1, 2], // 스위치 A: 전구 1, 2, 3 토글
            [1, 3],    // 스위치 B: 전구 2, 4 토글
            [0, 2, 4], // 스위치 C: 전구 1, 3, 5 토글
            [2, 3],    // 스위치 D: 전구 3, 4 토글
            [1, 4]     // 스위치 E: 전구 2, 5 토글
        ];

        // 퍼즐의 목표 상태 (모든 전구가 켜져야 함)
        const targetState = [true, true, true, true, true];

        /**
         * 특정 인덱스의 전구 상태를 토글하고 시각적으로 업데이트합니다.
         * @param {number} index - 토글할 전구의 인덱스 (0-4).
         */
        function toggleLightVisual(index) {
            const lightElement = lights[index];
            const lightNumberSpan = lightElement.querySelector('span');

            lightStates[index] = !lightStates[index]; // 실제 상태 업데이트

            if (lightStates[index]) { // 켜짐 상태
                lightElement.classList.add('on');
                lightElement.classList.remove('bg-gray-600', 'border-gray-700');
                if (lightNumberSpan) {
                    lightNumberSpan.classList.add('text-gray-800');
                    lightNumberSpan.classList.remove('text-gray-400');
                }
            } else { // 꺼짐 상태
                lightElement.classList.remove('on');
                lightElement.classList.add('bg-gray-600', 'border-gray-700');
                if (lightNumberSpan) {
                    lightNumberSpan.classList.remove('text-gray-800');
                    lightNumberSpan.classList.add('text-gray-400');
                }
            }
        }

        /**
         * 퍼즐의 현재 상태가 목표 상태와 일치하는지 확인합니다.
         * @returns {boolean} - 목표 상태와 일치하면 true, 아니면 false.
         */
        function checkPuzzleCompletion() {
            const isSolved = lightStates.every((state, index) => state === targetState[index]);

            if (isSolved) {
                puzzleMessage.classList.remove('hidden'); // 완료 메시지 표시
                buttons.forEach(button => button.disabled = true); // 모든 버튼 비활성화
                resetButton.disabled = true; // 리셋 버튼 비활성화

                // 퍼즐 해결 후 다음 페이지로 이동
                setTimeout(() => {
                    // alert('축하합니다! 전구 퍼즐을 해결했습니다! 다음 단계로 이동합니다.'); // 임시 알림 제거
                    // 여기에 최종 페이지의 HTML 파일 이름을 넣어주세요. (예: 'final_escape_page.html')
                    // window.location.href = window.location.origin + '/final_escape_page.html';
                }, 2000);

            } else {
                puzzleMessage.classList.add('hidden'); // 완료 메시지 숨김
                buttons.forEach(button => button.disabled = false); // 버튼 활성화
                resetButton.disabled = false; // 리셋 버튼 활성화
            }
            return isSolved;
        }

        /**
         * 퍼즐을 초기 상태로 되돌립니다.
         * 모든 전구를 끄고, 전구 상태 배열을 초기화합니다.
         */
        function resetPuzzle() {
            // 모든 전구를 강제로 끄기
            for (let i = 0; i < lightStates.length; i++) {
                if (lightStates[i]) { // 켜져 있는 전구만 끄기
                    toggleLightVisual(i); // toggleLightVisual은 상태를 토글하므로, 켜져 있는 것을 끄게 됨
                }
            }
            // lightStates 배열을 모두 false로 초기화 (혹시 모를 불일치 방지)
            lightStates = [false, false, false, false, false];
            checkPuzzleCompletion(); // 초기화 후 퍼즐 완료 여부 다시 확인 (메시지 숨김, 버튼 활성화)
        }

        // 각 버튼에 클릭 이벤트 리스너를 추가합니다.
        buttons.forEach((button, buttonIndex) => {
            button.addEventListener('click', () => {
                // 이 버튼이 영향을 미치는 모든 전구에 대해 상태를 토글합니다.
                buttonEffects[buttonIndex].forEach(lightIndex => {
                    toggleLightVisual(lightIndex);
                });
                checkPuzzleCompletion(); // 변경 후 퍼즐 완료 여부 확인
            });
        });

        // 리셋 버튼에 클릭 이벤트 리스너를 추가합니다.
        resetButton.addEventListener('click', resetPuzzle);

        // 페이지 로드 시 초기 상태 설정 (모든 전구 꺼짐)
        resetPuzzle();
    </script>
</body>
</html>
